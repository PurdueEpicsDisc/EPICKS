<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<script src='https://cdn.firebase.com/js/client/2.2.1/firebase.js'></script>

    <link href='http://fonts.googleapis.com/css?family=Open+Sans|Lora' rel='stylesheet' type='text/css'>
    <title>EPICS | explorer</title>
    <link rel='stylesheet' href='css/font-awesome.min.css' type='text/css' media='all' />
    <link rel='stylesheet' href='stylesheets/screen.css' type='text/css' media='all' />


</head>

<!---intro page starts --
<div id="splashscreen" style="background-image: url('http://2.bp.blogspot.com/-BJdvrIgTQKQ/UobS7PHZv3I/AAAAAAAACDA/Gb_oUjnXRkM/s1600/P1030580.JPG'); background-position: center;">
  <center>
  
        <div id="splash-header">
        <a class="logotype-purdue" href="http://www.purdue.edu/"><img class="logotype" src="images/Purdue.png" /></a>
        <a class="logotype-epics" href="https://engineering.purdue.edu/EPICS"><img class="logotype" src="images/EPICS.png" /></a>
      </div>

    <br><br><br><br><br>
    <div id = "login">
<form id="fm1" >

    <div style="padding: 30px; border: 15px solid #A37B2C; width: 300px; border ;border-radius: 30px;">

    <fieldset>
    <h2>Welcome !</h2>

    <label for="username"><span>L</span>ogin:</label>
    <input placeholder="Username" id="initialUser" type="text" name="Username" value="" size="25" maxlength="25" autocomplete="false" / ><br>

    <label for="password"><span>P</span>assword:</label>
    <input placeholder="Password" id="initialPass" type="password" name="Password" value="" size="23" maxlength="23" autocomplete="off"/><br>
    
    <button><a href="#" class="enter_link">Login</a></button>
  </center>
    <script type="text/javascript">
      $('#initialPass').on("keypress", function(e) {if (e.keyCode == 13) login() }, function(error, authData) {  //all three braces are part of the on keypress, same below
            if (error) {
            } else {
              $('#splashscreen').fadeOut(500); //div splashcreen on line 6
            }
        }, {remember: "sessionOnly"});

      $('.enter_link').click(login(), function(error, authData) {
          if (error) {
          } else {
            $('#splashscreen').fadeOut(500);
          }
        }, {remember: "sessionOnly"});

      function login() { 
        myDataRef.authWithPassword({
          "email": document.getElementById("initialUser").value,
          "password": document.getElementById("initialPass").value 
        }
    </script>
    
    </fieldset>
    </form>

    </div>

    </div>
</div>

<!-- intro page ends -->

<div>

        <div id="splash-header">
        <a class="logotype-purdue" href="http://www.purdue.edu/"><img class="logotype" src="images/Purdue.png" /></a>
        <a class="logotype-epics" href="https://engineering.purdue.edu/EPICS"><img class="logotype" src="images/EPICS.png" /></a>

        <button onclick="logout()" style="float: right;">Log Out</button>

      </div>
</div>
<script>

	var myDataRef = new Firebase('https://e-picks-purdue.firebaseio.com/');
  var authData = myDataRef.getAuth();
  if (authData) {
    $('#splashscreen').fadeOut(500);
  }

	function submit(thing) { //add new group function

  
    var team_name = thing.parentElement.children[0].value;
    var team_abbrev = thing.parentElement.children[2].value;
    var website = thing.parentElement.children[4].value;
    var day = thing.parentElement.children[6].value;
    var time_num = thing.parentElement.children[8].value;
    switch(time_num){
      case "1":
        var time = "8:30 AM - 10:20 AM";
        break;
      case "2":
        var time = "10:30 AM - 12:20 PM";
        break;
      case "3":
        var time = "1:30 PM - 3:20 PM";
        break;
      case "4":
        var time = "3:30 PM - 5:20 PM";
        break;
      default:
        var time = "Other";
    }
    var aoi = thing.parentElement.children[10].value;
    var desc = thing.parentElement.children[13].value;
    /*  
    var day = $('#newDay').val();
    $('#newDay').val('Choose a Day');
    var desc = $('#newDesc').val();
    $('#newDesc').val(null);
    var team_abbrev = $('#newAc').val();
    $('#newAc').val(null);
    var team_name = $('#newName').val();
    $('#newName').val(null);
    var time_num = $('#newTime').val();
    $('#newTime').val('Choose a Time');
    switch(time_num){
      case "1":
        var time = "8:30 AM - 10:20 AM";
        break;
      case "2":
        var time = "10:30 AM - 12:20 PM";
        break;
      case "3":
        var time = "1:30 PM - 3:20 PM";
        break;
      case "4":
        var time = "3:30 PM - 5:20 PM";
        break;
      default:
        var time = "Something is messed up";
    }
    var website = $('#newWebsite').val();
    $('#newWebsite').val(null);
    var aoi = $('#newAOI').val();
    $('#newAOI').val('Choose an Area');
    */


    //alert(day + "  "+ desc + "  "+ team_abbrev + "  "+ team_name +  "  " + time + "  " + time_num + "  " + website);

    var tempRef = myDataRef.child(team_abbrev); //myDataRef is the Firebase object and this adds a new child titled with the description field.

    /*var r = confirm("Are you sure?");
    if (r == true) {
      x = "Team Deleted";
    } else {
      return;
    } */

    tempRef.update({ //update function makes changes to JSON fields
       aoi: aoi,
       day: day,
       description: desc,
       team_abbrev: team_abbrev,
       team_name: team_name,
       time: time,
       time_num: time_num,
       website: website
    });

    document.location.reload(true); 
}

function word2find(anywords){
  inputText = document.getElementById("wordSearch") ;
  var innerHTML = inputText.innerHTML;
  var ws_index = innerHTML.indexOf(anywords);
  if (ws_index >=0)
  {
    innerHTML = innerHTML.substring(0,index) + "<span class = 'highlight'>" + innerHTML.substring(ws_index, ws_index + anywords.length) + "</span>" + innerHTML.substring(ws_index + anywords.length);
    inputText.innerHTML = innerHTML;
  }

}

function logout() {
  myDataRef.unauth();
  document.location.reload(true);
}

function goodbye(abbrev) { //other function names might conflict with standard names
  //alert(abbrev);

  var r = confirm("Are you sure?");
  if (r == true) {
    x = "Team Deleted";
  } else {
    return;
  }

  var delChild = myDataRef.child(abbrev);
  delChild.remove();
  document.location.reload(true);
}

function edit(abbrev) {
  //alert(abbrev);
  var ed = myDataRef.child(abbrev);

  var name, acc, web, day, time, aoi, desc;
  
  ed.once("value", function(snapshot) {
    name = snapshot.val().team_name;
    acc = snapshot.val().team_abbrev;
    web = snapshot.val().website; 
    day = snapshot.val().day;
    aoi = snapshot.val().aoi;
    desc = snapshot.val().description;
    time = snapshot.val().time;
  });

  $("#" + abbrev).remove();
  //The below should be replaced with the new edit form
  $("#" + abbrev + "outer").append($('<div>Team Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="TeamName" id="newName'+acc+'" value="'+name+'"><br>Team Acronym:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="TeamAcronym" id="newAc'+acc+'" value="'+acc+'"><br>Website:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="Website" value="'+web+'" id="newWebsite'+acc+'"><br>Day:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select id="newDay'+acc+'"><option>'+day+'</option><option value="Monday">Monday</option><option value="Tuesday">Tuesday</option><option value="Wednesday">Wednesday</option><option value="Thursday">Thursday</option><option value="Friday">Friday</option></select><br> Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select value="'+time+'" id = "newTime'+acc+'">  <option value="1">8:30 AM - 10:20 AM</option><option value="2">10:30 AM - 12:20 PM</option><option value="3">1:30 PM - 3:20 PM</option><option value="4">3:30 PM - 5:20 PM</option><option value="5">Other</option></select><br>Area of Impact:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<select id = "newAOI'+acc+'"><option>'+aoi+'</option><option value="Access & Abilities">Access & Abilities</option><option value="Education & Outreach">Education & Outreach</option><option value="Environment">Environment</option><option value="Human Services">Human Services</option></select><br>Description:<br> <TEXTAREA NAME="Description" id="newDesc'+acc+'" ROWS=5 COLS=50 >'+desc+'</textarea><br><input type="submit" onclick="submit(this)" value="Submit">'));
}

	myDataRef.on('child_added', function(snapshot) {
  	var team = snapshot.val();
   		displayTeamInfo(team.team_abbrev, team.description, team.aoi, team.day, team.team_name, team.time, team.website, team.time_num);
  	});

  	function displayTeamInfo(abbrev, desc, aoi, day, name, time, website, time_num) {
    	$("#team-objects").append( //unholy mess, need to fix this with some css
      	$(
          '<div id="'+abbrev+'outer" style="background-color:#f0f0f0; outline-style: solid; padding-top: 5px; padding-right: 3px; padding-bottom: 5px; padding-left: 8px;">
            <div id="'+abbrev+'">  
              Team Name:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+ name + "<br>
              Team Acronym:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" +  abbrev + "<br>
              Website:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + website +"<br>
              Day:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + day +"<br>
              Time:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + time +"<br>Area of 
              Impact:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;" + aoi + '<br>
              Description:<br>' + desc + '<br>
              <input type="submit" value="Edit" onclick="edit(\''+abbrev+'\')">
              <input type="submit" value="Delete" onclick="goodbye(\''+abbrev+'\')">
            </div>
          </div>')
    );
  };

</script>

<!-- add to the css here -->
<style> 


html, body, div, span, h1, h2, fieldset, form, label, legend, {
  margin: 0;
  padding: 0;
  border: 0;
  outline: 0;
  font-weight: inherit;
  font-style: inherit;
  font-size: 80%;
  font-family: inherit;
  vertical-align: baseline;
  background: transparent;
}

body {
    background-color:white;
}

h2 {
  font-size:300%;
  font-weight:bold;
  color:#FFFFFF;
  text-align:center;
  margin:0 0 1.3em;
}

#login form {
  padding:0 50px 25px 50px;
  min-height: 200px;
  height: auto;
}

#login p {
  text-align:left;
  margin:10px 0;
}

#login fieldset {
  margin:0 auto;
  padding:114px 0 10px 0;
  text-align:left;
}

fieldset label {
  display:block;
  font-weight:bold;
  font-size:125%;
}
fieldset input {
  font-size:145%;
  width:100%;
  font-weight:bold;
  border:1px solid #EEEEEE;
  border-left:1px solid #999999;
  border-top:1px solid #999999;
}
fieldset input:focus {
  border:1px solid ;
  background:none #FFFFFF;
}

fieldset p, fieldset div {
  margin:10px 20px !important;
}

#splashscreen {
    position: fixed;
    top:0;
    left:0;
    bottom:0;
    width:100%;
    height:100%;
    background-color:white;
    overflow: hidden;

    .highlight
    {
      background-color: yellow;
    }
}
</style>

<!--ToDo: put all the html stuff here -->

<div>
	<div style="background-color:#808080; outline-style: solid; padding-top: 5px; padding-right: 3px; padding-bottom: 5px; padding-left: 8px;"> <!--Form for adding new team -->

<br>
Search:
&nbsp;&nbsp;&nbsp;
<input type="text" name="keyword" id="wordSearch" placeholder="Enter keywords">&nbsp;
  <button onclick="word2find()" >Search</button>
<br><br>


<div>
Team Name:
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;
<input type="text" name="TeamName" id="newName" placeholder="Enter team name"><br>

Team Acronym:
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
<input type="text" name="TeamAcronym" id="newAc" placeholder="Enter team acronym" ><br>

Website:
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
<input type="text" name="Website" id="newWebsite" placeholder="Enter a website"><br>

Day:
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
<select id="newDay">
  <option>Choose a Day</option>
  <option value="Monday">Monday</option>
  <option value="Tuesday">Tuesday</option>
  <option value="Wednesday">Wednesday</option>
  <option value="Thursday">Thursday</option>
  <option value="Friday">Friday</option>
</select><br> 

Time:
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;
<select id = "newTime">
  <option>Choose a Time</option>
  <option value="1">8:30 AM - 10:20 AM</option>
  <option value="2">10:30 AM - 12:20 PM</option>
  <option value="3">1:30 PM - 3:20 PM</option>
  <option value="4">3:30 PM - 5:20 PM</option>
  <option value="5">Other</option>
</select><br>

Area of Impact:
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
&nbsp;
<select id = "newAOI">
  <option>Choose an Area</option>
  <option value="Access & Abilities">Access & Abilities</option>
  <option value="Education & Outreach">Education & Outreach</option>
  <option value="Environment">Environment</option>
  <option value="Human Services">Human Services</option>
</select><br>

Description:<br> 
<TEXTAREA NAME="Description" id="newDesc" ROWS=3 COLS=30 ></textarea><br>
<input type="submit" value="Submit" onclick="submit(this)"><br>

</div>

</div> <!-- all the teams are going here, change from all to just search results here. -->
    <div id="team-objects"></div>
</div>